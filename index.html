<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Love Surprise ğŸ’–</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
  margin:0;
  font-family:sans-serif;
  background:linear-gradient(135deg,#ff9a9e,#fecfef);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  background:white;
  padding:25px;
  border-radius:20px;
  width:90%;
  max-width:420px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
}
textarea,input{
  width:100%;
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
}
button{
  margin-top:10px;
  padding:12px;
  width:100%;
  border:none;
  border-radius:10px;
  background:#ff4d6d;
  color:white;
  font-size:16px;
  cursor:pointer;
}
.hidden{display:none;}
.story{
  white-space:pre-line;
  margin-top:15px;
}
</style>
</head>
<body>

<!-- ===== à¸«à¸™à¹‰à¸² Creator ===== -->
<div class="box" id="creator">
  <h2>ğŸ’– à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸‹à¸­à¸£à¹Œà¹„à¸à¸£à¸ªà¹Œà¹à¸Ÿà¸™</h2>

  <textarea id="message" placeholder="à¹€à¸‚à¸µà¸¢à¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸–à¸¶à¸‡à¹à¸Ÿà¸™..."></textarea>
  <input type="text" id="youtube" placeholder="à¸§à¸²à¸‡à¸¥à¸´à¸‡à¸à¹Œ YouTube (à¸–à¹‰à¸²à¸¡à¸µ)">
  <input type="password" id="password" placeholder="à¸•à¸±à¹‰à¸‡à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™">

  <button onclick="generateLink()">à¸ªà¸£à¹‰à¸²à¸‡à¸¥à¸´à¸‡à¸à¹Œ ğŸ’Œ</button>

  <textarea id="result" placeholder="à¸¥à¸´à¸‡à¸à¹Œà¸ˆà¸°à¸‚à¸¶à¹‰à¸™à¸•à¸£à¸‡à¸™à¸µà¹‰..." readonly></textarea>
  <button onclick="copyLink()">ğŸ“‹ à¸„à¸±à¸”à¸¥à¸­à¸à¸¥à¸´à¸‡à¸à¹Œ</button>
</div>


<!-- ===== à¸«à¸™à¹‰à¸² Viewer ===== -->
<div class="box hidden" id="viewer">
  <h2 id="viewerTitle">ğŸ” à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¸à¹ˆà¸­à¸™</h2>

  <div id="lockBox">
    <input type="password" id="inputPass" placeholder="à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™">
    <button onclick="unlock()">à¹€à¸›à¸´à¸”à¸”à¸¹ ğŸ’–</button>
    <p id="error" style="color:red;"></p>
  </div>

  <div id="content" class="hidden">
    <div class="story" id="showMessage"></div>
    <div id="videoBox"></div>
    <button onclick="goHome()">ğŸ”™ à¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸«à¸¡à¹ˆ</button>
  </div>
</div>


<script>

// ===== à¸ªà¸£à¹‰à¸²à¸‡à¸¥à¸´à¸‡à¸à¹Œ =====
function generateLink(){

  const message=document.getElementById("message").value.trim();
  const youtube=document.getElementById("youtube").value.trim();
  const password=document.getElementById("password").value.trim();

  if(!message || !password){
    alert("à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸à¸±à¸šà¸£à¸«à¸±à¸ªà¸à¹ˆà¸­à¸™ ğŸ’–");
    return;
  }

  let ytID="";
  if(youtube){
    const reg=/^(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&]+)/;
    const match=youtube.match(reg);
    if(match){ ytID=match[1]; }
  }

  const data={
    msg:message,
    yt:ytID,
    pass:password
  };

  const encoded=btoa(encodeURIComponent(JSON.stringify(data)));

  const baseUrl=window.location.origin + window.location.pathname;
  const link=baseUrl + "?data=" + encoded;

  document.getElementById("result").value=link;
}


// ===== à¸„à¸±à¸”à¸¥à¸­à¸à¸¥à¸´à¸‡à¸à¹Œ =====
function copyLink(){
  const link=document.getElementById("result").value;
  if(!link){
    alert("à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸¥à¸´à¸‡à¸à¹Œ ğŸ’”");
    return;
  }
  navigator.clipboard.writeText(link)
  .then(()=>alert("à¸„à¸±à¸”à¸¥à¸­à¸à¹à¸¥à¹‰à¸§ ğŸ’–"))
  .catch(()=>alert("à¸à¸”à¸„à¹‰à¸²à¸‡à¹à¸¥à¹‰à¸§à¸„à¸±à¸”à¸¥à¸­à¸à¹€à¸­à¸‡à¸™à¸°"));
}


// ===== à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸ URL =====
function getData(){
  const params=new URLSearchParams(window.location.search);
  const encoded=params.get("data");
  if(!encoded) return null;

  try{
    return JSON.parse(decodeURIComponent(atob(encoded)));
  }catch{
    return null;
  }
}


// ===== à¸•à¸£à¸§à¸ˆà¸•à¸­à¸™à¹‚à¸«à¸¥à¸”à¸«à¸™à¹‰à¸² =====
window.onload=function(){

  const data=getData();
  if(!data) return;

  document.getElementById("creator").classList.add("hidden");
  document.getElementById("viewer").classList.remove("hidden");

  window.currentData=data;
};


// ===== à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸ =====
function unlock(){

  const input=document.getElementById("inputPass").value;
  const data=window.currentData;

  if(input===data.pass){

    document.getElementById("lockBox").classList.add("hidden");
    document.getElementById("content").classList.remove("hidden");
    document.getElementById("viewerTitle").innerText="ğŸ’– à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸–à¸¶à¸‡à¹€à¸˜à¸­ ğŸ’–";
    document.getElementById("showMessage").innerText=data.msg;

    confetti({particleCount:150,spread:100});

    if(data.yt){
      document.getElementById("videoBox").innerHTML=
      `<iframe width="100%" height="200"
      src="https://www.youtube.com/embed/${data.yt}?autoplay=1"
      allow="autoplay"></iframe>`;
    }

  }else{
    document.getElementById("error").innerText="à¸£à¸«à¸±à¸ªà¸œà¸´à¸”à¸™à¸° ğŸ’”";
  }
}


// ===== à¸à¸¥à¸±à¸šà¸«à¸™à¹‰à¸²à¹à¸£à¸ =====
function goHome(){
  window.location.href = window.location.origin + window.location.pathname;
}

</script>

</body>
</html>
